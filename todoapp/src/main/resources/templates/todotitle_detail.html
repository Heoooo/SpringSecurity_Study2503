<!DOCTYPE html>
<html layout:decorate="~{layout}">
	
	<div layout:fragment="content" class="container my-3">
		<h5 class="my-3 border-bottom pb-2" th:text="${todotitle.subject}"></h5>
		
		<div class="text-end">
			작성자 : <span class="fw-bold" th:if="${todotitle.writer != null}" th:text="${todotitle.writer.username}"></span>
			(Create Date : <span th:text="${todotitle.createDate}"></span>)
		</div>
	
		<div  class="pb-5 text-black-50" th:text="${todotitle.content}"></div>
		
		<!-- 수정 버튼 만들기 Start -->			
		<div class="my-3 pb-5 position-relative border">
		
			<a href="javascript:void(0);"
				th:data-uri="@{|/todotitle/delete/${todotitle.id}|}"
				class="delete btn btn-sm btn-secondary float-end"
				sec:authorize="isAuthenticated()"
				th:if="${todotitle.writer != null and #authentication.getPrincipal().getUsername() == todotitle.writer.username}"
				th:text="Delete"
			></a>
		
			<a th:href="@{|/todotitle/modify/${todotitle.id}|}"
				class="btn btn-sm btn-warning float-end me-3"
				sec:authorize="isAuthenticated()"
				th:if="${todotitle.writer != null and #authentication.getPrincipal().getUsername() == todotitle.writer.username}"
				th:text="Update">			
			</a>
			<!-- 
				버튼 정렬
				float-end : float 되는 개념이기 때문에 레이아웃이 복잡한 경우 깨질 수 있음. 주의가 필요!
				position-absolute top-0 end-0 : 단, 이 경우에는 상위 div 박스에 position-relative 적용이 필요! 
			 -->
			 <!-- 
			 	값 체크
			 	<span th:text="${todotitle.writer.username}">admin</span>
			 	<span th:text="${#authentication.getPrincipal().getUsername()}">abc</span>
			  -->
		</div>
		<!-- 수정 버튼 만들기 End -->
		
		<h6 th:text="|${#lists.size(todotitle.todoworkList)} 개의 관련 할 일이 등록되어 있습니다.|"></h6>
		<div>
			<ul>
			
				<!--li th:each="tw : ${todotitle.todoworkList}" th:text="${tw.content}"></li-->
				<li th:each="tw : ${todotitle.todoworkList}">
					<span th:text="${tw.content}"></span>
					&nbsp; - &nbsp;					
					<span th:if="${tw.writer != null}" th:text="${tw.writer.username}" class="fw-bold text-primary"></span>
					<span class="small">(<span th:text="${tw.createDate.substring(0,5)}"></span>)</span>
					<!--span th:text="${#temporals.format(tw.createDate,'yyyy-MM-dd HH:mm')}"></span-->
				</li>
				
			</ul>
		</div>
		
		<div class="pb-5">
			<form th:action="@{|/todowork/create/${todotitle.id}|}" th:object="${todoworkCreateForm}"method="POST" autocomplete="off">
				
				<!--
				<div sec:authorize="isAnonymous()">
					<input disabled value="로그인 해야지만 글 작성 가능" type="text" name="content" class="form-control">
					<input disabled type="submit" value="할 일 등록하기" class="btn btn-dark mt-2">
				</div>
				
				<div sec:authorize="isAuthenticated()">
					<input type="text" name="content" class="form-control" required autofocus>
					<input type="submit" value="할 일 등록하기" class="btn btn-dark mt-2">
				</div>
				-->
				
				<!-- 에러 출력 -->
				<div class="alert alert-danger" role="alert" th:if="${#fields.hasAnyErrors()}">
					<div th:each="err : ${#fields.allErrors()}" th:text="${err}">
					</div>
				</div>
				
				<input sec:authorize="isAnonymous()" disabled value="로그인 해야지만 글 작성 가능" type="text" name="content" class="form-control">
				<input sec:authorize="isAuthenticated" type="text" name="content" class="form-control" autofocus>
				<input type="submit" value="할 일 등록하기" class="btn btn-dark mt-2">
			
				<!--
				<div sec:autorize="isAnonymous()">
					<input disabled value="로그인 해야지만 글 작성 가능" type="text" name="content" class="form-control">
					<input type="submit" value="할 일 등록하기" class="btn btn-dark mt-2">
				</div>
				-->
			</form>
		</div>
		
		<a th:href="@{/todotitle/list}" class="btn btn-danger d-flex justify-content-center">할 일 목록 페이지</a>
		<!--
		<div class="d-flex justify-content-center">
			<a th:href="@{/todotitle/list}" class="btn btn-danger">할 일 목록 페이지</a>
		</div>
		-->
	</div>
	
</html>